# ãŠæ¤€3Dãƒ¡ãƒƒã‚·ãƒ¥åˆ†æãƒ¬ãƒãƒ¼ãƒˆ

**åˆ†ææ—¥æ™‚**: 2025-11-01
**å¯¾è±¡ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª**: `/Users/moei/program/D405/data/mesh_output/`

---

## ğŸ“‹ æ¤œå‡ºã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«

| ãƒ•ã‚¡ã‚¤ãƒ«å | ã‚µã‚¤ã‚º | é ‚ç‚¹æ•° | é¢æ•° |
|-----------|-------|--------|------|
| 001_bowl_mesh.ply | 32 MB | 676,564 | 1,351,340 |
| 002_bowl_mesh.ply | 40 MB | 837,524 | 1,673,660 |
| 003_bowl_mesh.ply | 41 MB | 859,328 | 1,716,556 |
| 004_bowl_mesh.ply | 37 MB | 771,790 | 1,539,444 |
| 005_bowl_mesh.ply | 29 MB | 617,210 | 1,233,720 |

**åˆè¨ˆ**: 5å€‹ã®ãŠæ¤€ãƒ¡ãƒƒã‚·ãƒ¥

---

## âœ… å®Ÿç‰©ã‚µã‚¤ã‚ºï¼ˆçµ¶å¯¾å€¤ï¼‰ä¿æŒç¢ºèª

### PLYãƒ˜ãƒƒãƒ€ãƒ¼æƒ…å ±

ã™ã¹ã¦ã®ãƒ¡ãƒƒã‚·ãƒ¥ã«ä»¥ä¸‹ã®æƒ…å ±ãŒå«ã¾ã‚Œã¦ã„ã¾ã™ï¼š

```
comment Units: millimeters (mm) âœ…
comment Original voxel spacing: 0.2xx-0.3xx mm âœ…
comment Coordinate system: RAS (Right-Anterior-Superior) âœ…
comment Generated from NIfTI medical imaging mask âœ…
```

### é‡è¦ãªç™ºè¦‹

#### 1. **å˜ä½ã®æ˜ç¤ºçš„å®£è¨€**

```
Units: millimeters (mm)
```

âœ… **çµè«–**: ã™ã¹ã¦ã®ãƒ¡ãƒƒã‚·ãƒ¥ã¯**ãƒŸãƒªãƒ¡ãƒ¼ãƒˆãƒ«ï¼ˆmmï¼‰å˜ä½ã§å®Ÿç‰©ã‚µã‚¤ã‚º**ã‚’ä¿æŒã—ã¦ã„ã¾ã™ã€‚

#### 2. **ãƒœã‚¯ã‚»ãƒ«ã‚¹ãƒ‘ã‚¤ã‚·ãƒ³ã‚°æƒ…å ±**

```
Original voxel spacing: 0.234-0.371 mm (XY), 0.300 mm (Z)
```

- åŒ»ç™‚ç”»åƒï¼ˆNIfTIï¼‰ã‹ã‚‰ç”Ÿæˆã•ã‚ŒãŸãƒ¡ãƒƒã‚·ãƒ¥
- å…ƒã®ãƒœã‚¯ã‚»ãƒ«è§£åƒåº¦ãŒä¿æŒã•ã‚Œã¦ã„ã‚‹
- é«˜ç²¾åº¦ãª3Dã‚¹ã‚­ãƒ£ãƒ³ç”±æ¥

#### 3. **åº§æ¨™ç³»**

```
Coordinate system: RAS (Right-Anterior-Superior)
```

- åŒ»ç™‚ç”»åƒã®æ¨™æº–åº§æ¨™ç³»
- å³æ‰‹ç³»åº§æ¨™ç³»

---

## ğŸ¯ ä½“ç©æ¨å®šãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã§ã®ä½¿ç”¨

### ä½¿ç”¨å¯èƒ½æ€§: âœ… å®Œå…¨å¯¾å¿œ

ã“ã‚Œã‚‰ã®ãƒ¡ãƒƒã‚·ãƒ¥ã¯ä»¥ä¸‹ã®ç”¨é€”ã§**ãã®ã¾ã¾ä½¿ç”¨å¯èƒ½**ã§ã™ï¼š

1. **ã‚¹ã‚±ãƒ¼ãƒ«å‚ç…§ç”¨ãŠæ¤€ã¨ã—ã¦ä½¿ç”¨**
   - å®Ÿç‰©ã‚µã‚¤ã‚ºï¼ˆmmå˜ä½ï¼‰ä¿æŒæ¸ˆã¿
   - ICPãƒ•ã‚£ãƒƒãƒ†ã‚£ãƒ³ã‚°ã®å‚ç…§ãƒ¢ãƒ‡ãƒ«ã¨ã—ã¦æœ€é©

2. **ä½“ç©æ¨å®šãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³**
   ```bash
   python3 scripts/estimate_food_volume.py \
     --rgb nutrition5k_data/imagery/realsense_overhead/rgb_*.png \
     --depth nutrition5k_data/imagery/realsense_overhead/depth_raw_*.png \
     --bowl-model data/mesh_output/001_bowl_mesh.ply \
     --bowl-diameter <å®Ÿæ¸¬ç›´å¾„(mm)> \
     --output results/volume_result.json
   ```

3. **å¿…è¦ãªè¿½åŠ æƒ…å ±**
   - âš ï¸ **å®Ÿç‰©ã®ãŠæ¤€ã®ç›´å¾„ã‚’æ¸¬å®š**ï¼ˆãƒã‚®ã‚¹ä½¿ç”¨æ¨å¥¨ï¼‰
   - å˜ä½: ãƒŸãƒªãƒ¡ãƒ¼ãƒˆãƒ«ï¼ˆmmï¼‰
   - æ¸¬å®šä½ç½®: ãŠæ¤€ã®æœ€å¤§ç›´å¾„éƒ¨åˆ†

---

## ğŸ“ æ¨å¥¨æ¸¬å®šæ‰‹é †

### ãŠæ¤€ã®å®Ÿå¯¸æ¸¬å®š

1. **ç›´å¾„æ¸¬å®š**
   ```
   æ¸¬å®šå™¨å…·: ãƒã‚®ã‚¹ï¼ˆãƒ‡ã‚¸ã‚¿ãƒ«æ¨å¥¨ï¼‰
   æ¸¬å®šä½ç½®: ãŠæ¤€ã®æœ€å¤§ç›´å¾„éƒ¨åˆ†
   å˜ä½: ãƒŸãƒªãƒ¡ãƒ¼ãƒˆãƒ«ï¼ˆmmï¼‰
   ç²¾åº¦: Â±0.1 mm
   ```

2. **é«˜ã•æ¸¬å®š**ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
   ```
   æ¸¬å®šä½ç½®: ãŠæ¤€ã®åº•ã‹ã‚‰ç¸ã¾ã§
   å˜ä½: ãƒŸãƒªãƒ¡ãƒ¼ãƒˆãƒ«ï¼ˆmmï¼‰
   ```

3. **è¨˜éŒ²ä¾‹**
   ```json
   {
     "001_bowl": {
       "diameter_mm": 120.5,
       "height_mm": 65.3,
       "date": "2025-11-01"
     }
   }
   ```

---

## ğŸ”§ ãƒ¡ãƒƒã‚·ãƒ¥ã®æŠ€è¡“çš„ç‰¹å¾´

### 1. é«˜è§£åƒåº¦

- å¹³å‡é ‚ç‚¹æ•°: 750,000é ‚ç‚¹
- å¹³å‡é¢æ•°: 1,500,000é¢
- è©³ç´°åº¦: éå¸¸ã«é«˜ç²¾åº¦

### 2. åŒ»ç™‚ç”»åƒç”±æ¥

- **NIfTIå½¢å¼**ã‹ã‚‰å¤‰æ›
- CTã‚¹ã‚­ãƒ£ãƒ³ã¾ãŸã¯MRIã‚¹ã‚­ãƒ£ãƒ³ç”±æ¥ã®å¯èƒ½æ€§
- ãƒœã‚¯ã‚»ãƒ«ãƒ™ãƒ¼ã‚¹ã®3Då†æ§‹æˆ

### 3. ãƒ•ã‚¡ã‚¤ãƒ«å½¢å¼

- **PLYå½¢å¼**: Binary Little Endian
- è‰²æƒ…å ±: å«ã¾ã‚Œã¦ã„ãªã„å¯èƒ½æ€§
- æ³•ç·šæƒ…å ±: è¦ç¢ºèª

---

## âš ï¸ æ³¨æ„äº‹é …

### 1. Watertightï¼ˆå¯†é–‰æ€§ï¼‰ãƒã‚§ãƒƒã‚¯

```python
import open3d as o3d
mesh = o3d.io.read_triangle_mesh("data/mesh_output/001_bowl_mesh.ply")
if not mesh.is_watertight():
    print("âš ï¸ ãƒ¡ãƒƒã‚·ãƒ¥ã«ç©´ã‚ã‚Š - ä¿®å¾©ãŒå¿…è¦")
    mesh = mesh.remove_degenerate_triangles()
    mesh = mesh.remove_duplicated_vertices()
```

### 2. ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚º

- å¤§ããªãƒ¡ãƒƒã‚·ãƒ¥ï¼ˆ29-41 MBï¼‰
- ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡ã«æ³¨æ„
- å¿…è¦ã«å¿œã˜ã¦ãƒ€ã‚¦ãƒ³ã‚µãƒ³ãƒ—ãƒªãƒ³ã‚°

### 3. è¤‡æ•°ãŠæ¤€ã®é¸æŠ

5ã¤ã®ãƒ¡ãƒƒã‚·ãƒ¥ã‹ã‚‰é©åˆ‡ãªã‚‚ã®ã‚’é¸æŠï¼š
```
- å®Ÿéš›ã«ä½¿ç”¨ã™ã‚‹ãŠæ¤€ã«æœ€ã‚‚è¿‘ã„å½¢çŠ¶
- å®Ÿæ¸¬ã‚µã‚¤ã‚ºã¨3Dãƒ¢ãƒ‡ãƒ«ã®ã‚µã‚¤ã‚ºã‚’ç…§åˆ
- ICPãƒ•ã‚£ãƒƒãƒ†ã‚£ãƒ³ã‚°ã®ç²¾åº¦ç¢ºèª
```

---

## ğŸ“Š æ¤œè¨¼æ‰‹é †

### Open3Dã§ã®ç°¡æ˜“æ¤œè¨¼

```python
import open3d as o3d
import numpy as np

# ãƒ¡ãƒƒã‚·ãƒ¥èª­ã¿è¾¼ã¿
mesh = o3d.io.read_triangle_mesh("data/mesh_output/001_bowl_mesh.ply")

# ãƒã‚¦ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ãƒœãƒƒã‚¯ã‚¹ï¼ˆmmå˜ä½ï¼‰
vertices = np.asarray(mesh.vertices)
bbox_size = vertices.max(axis=0) - vertices.min(axis=0)

print(f"ã‚µã‚¤ã‚º (mm): {bbox_size}")
print(f"ã‚µã‚¤ã‚º (cm): {bbox_size/10}")

# å¯è¦–åŒ–
o3d.visualization.draw_geometries([mesh])
```

**æœŸå¾…ã•ã‚Œã‚‹å‡ºåŠ›ä¾‹**:
```
ã‚µã‚¤ã‚º (mm): [120.5, 118.3, 65.2]
ã‚µã‚¤ã‚º (cm): [12.05, 11.83, 6.52]
```

---

## âœ… æœ€çµ‚çµè«–

### å®Ÿç‰©ã‚µã‚¤ã‚ºä¿æŒ: âœ… YES

**è¨¼æ‹ **:
1. âœ… PLYãƒ˜ãƒƒãƒ€ãƒ¼ã«æ˜ç¤ºçš„ãªå˜ä½å®£è¨€ï¼ˆmmï¼‰
2. âœ… ãƒœã‚¯ã‚»ãƒ«ã‚¹ãƒ‘ã‚¤ã‚·ãƒ³ã‚°æƒ…å ±ä¿æŒ
3. âœ… åŒ»ç™‚ç”»åƒç”±æ¥ã®é«˜ç²¾åº¦ãƒ¡ãƒƒã‚·ãƒ¥
4. âœ… åº§æ¨™ç³»æƒ…å ±ï¼ˆRASï¼‰ä¿æŒ

### ä½¿ç”¨å¯å¦: âœ… ä½¿ç”¨å¯èƒ½

**è¦ä»¶**:
- âœ… ã‚¹ã‚±ãƒ¼ãƒ«å¤‰æ›ä¸è¦
- âš ï¸ å®Ÿç‰©ãŠæ¤€ã®ç›´å¾„æ¸¬å®šãŒå¿…è¦ï¼ˆ--bowl-diameterãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ç”¨ï¼‰
- âš ï¸ Watertightãƒã‚§ãƒƒã‚¯æ¨å¥¨
- âœ… ãã®ã¾ã¾ä½“ç©æ¨å®šãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã§ä½¿ç”¨å¯èƒ½

---

## ğŸš€ æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—

1. **å®Ÿç‰©ãŠæ¤€ã®ç›´å¾„æ¸¬å®š**
   ```bash
   # ãƒã‚®ã‚¹ã§æ¸¬å®š
   # çµæœã‚’ãƒ¡ãƒ¢: ä¾‹) 120.5 mm
   ```

2. **ãƒ¡ãƒƒã‚·ãƒ¥ã®Watertightãƒã‚§ãƒƒã‚¯**
   ```bash
   python3 scripts/check_mesh_quality.py data/mesh_output/001_bowl_mesh.ply
   ```

3. **SAM2.1ã§ã‚»ã‚°ãƒ¡ãƒ³ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³**
   ```bash
   python3 src/segmentation.py \
     nutrition5k_data/imagery/realsense_overhead/rgb_test_food_*.png
   ```

4. **å®Œå…¨ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³å®Ÿè¡Œ**
   ```bash
   python3 scripts/estimate_food_volume.py \
     --rgb nutrition5k_data/imagery/realsense_overhead/rgb_test_food_*.png \
     --depth nutrition5k_data/imagery/realsense_overhead/depth_raw_test_food_*.png \
     --bowl-model data/mesh_output/001_bowl_mesh.ply \
     --bowl-diameter 120.5 \
     --output results/volume_test.json
   ```

---

**æº–å‚™å®Œäº†ï¼** ãŠæ¤€ãƒ¡ãƒƒã‚·ãƒ¥ã¯å®Ÿç‰©ã‚µã‚¤ã‚ºã§ä¿æŒã•ã‚Œã¦ãŠã‚Šã€ä½“ç©æ¨å®šãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã§ä½¿ç”¨å¯èƒ½ã§ã™ã€‚
